services:
- docker
env:
  global:
    - secure: "OtxRw9MtJrc7EiXg+fLU+C3PUcinLb3AJ41AkGORfMfDiQDunItbiSdB7Ep3GKY3AFfAg8Z9E30uiQwxDecef9VU53wYAWCryvRSqTULfjk9fn/B6sPzlx/CehocY6iYf8A/KlFYcJ6mwx7bWKysYuADKoKLQPjI5hI5XK1TIGgLIPr6KdDLP/oFgwBGPxQkxqsAjpMQKwSsE+wC7JGXdAhDvpFadV98TKt75x/5xR+8vJR1SCNVWR0Q6qg4iwI2pTh+Vt7d+QOkItyB68wxv9+wkAigNf2RKG7ShDsytQC2y8PhjudvFDfKw9+7KBO9PqAqhmlHkR2ZQUKUOck7mm+5y9vNdkYqf8Rcsh4wjb9WlptgssLXAKelY3ThZHvlr4L14bTiDLLiu3s8xj3D3F8xg6jKiMIuY3CEAYhtwByJZlSx+6jxPwTXE54r2jenERfvM10vLhjO7b10JtKOBd+9AdnTb32K9JAoOMpjgKkManBTCDCjy3ba6Lxp4I6SpbVmiu12IUvg6HbTAkuYMX5MWD5J/DFXiXYhLN/BhH/et0koe76o+/vBSvLoMKxEyrCQ31Wx77ysuiMozCYb+wesEMpvtk+xKVfinZMQ/mu04dQLLRlSqPleUzhM5GeL9rVMzNHsA1Lo6BJOREoWf4l51rqJPX7Mixc7j+YVd5A="
    - secure: "MphzWvO9xOkg5gehVcNIr/vwMOH2CfgLVbXnIa5GQE048lzINaXMgf/uPnO6enyEK3E2rTJMyOcGV4von9TwIaZlZ4fLBzuk7gDyzE7erqtoxAfMVU9AOZnJsDdysOoSQKLenHpGBbOXJHTTsMPiizbshuQ5Nwd65DFaZUJMWfA9XkzvmTzQDbNeu8nX1b8XYTtU2BoFSNaCFFjr8Hi1llimO1zupDi7QQlIF8r3UjNQsG0Yh5gXraPeKa0+7fHZstAGikGBbzXh4TfoS36lzXlirObs53/FrueROUCSKu3rFDXGZC/T52TrWL+xd1JgjtTd3o0HfMFavXLR5BYbOJAEWS0aQprw+mhxCpDW2S99M2FJL4RnynzcnY5MOS7Jdk0/36Fuz+kbW5Ppi45QlP5iT9xtjrXjbBIprUCjhjiJYe+lrhYmKrs+e2ljv8gUpppi1iBPdkWBHt+k1SlNX+ceijfoGeTOMpfLCH7EBv7FaB+tDj8lH5RlE+iUMXVZMECe6qDCGjN1ggt2fnMiYDM7uU48OJ6+/62Wkmph6JNdTYeW3r97sWnDDXSFWkGq+LJ1H3pkeGazEJe6PSZG03APQvM6E3BKWWCi/8aAFaYhmUQ4Ci418pd4Zd3TzarMhujJg09rEurMWCMQpp04+NXQc+Hkew7gZgbM1+MVRrA="
script:
- export SAVE=$PWD cnt="ubucphctr" slim=".slim"
- "./scripts/slimceph"
- docker tag ceph/daemon.slim ${cnt}${slim}
before_deploy:
- cd
- wget `curl -s https://api.github.com/repos/appc/docker2aci/releases | grep browser_download_url
  | head -n 1 | cut -d '"' -f 4` -O d2a.tar.gz
- tar -zxf d2a.tar.gz && rm d2a.tar.gz && d2a=`ls | grep "docker2aci*"` && d2a=`basename  $d2a`
  && alias d2a='${PWD}/${d2a}/docker2aci'
- docker save -o ${cnt}${slim}.tar ${cnt}${slim}
- "${PWD}/${d2a}/docker2aci ${cnt}${slim}.tar"
- xz -9 -c ${cnt}${slim}.tar > ${cnt}${slim}.tar.xz
- docker login -u $quaylogin -p $quaypsw quay.io
- docker tag ${cnt}${slim} quay.io/natostanco/$cnt
- docker push quay.io/natostanco/$cnt
deploy:
  provider: releases
  api_key:
    secure: kQf2HeVQyCTgEwVv9pOV3RSTReoIlkf/1Xl2TRquXwC8ZQDNw+BKfsNM6y7e/ApkFoFVK7fjE/Ct8r7IJ9IEre+lg7n5NkW3aSwimzlgZLdk+ePihaKs2SIpDIf29LogcRznP96CDbhR7jR7P3A0KnUc2VDw6EhlDRcfzkksI/bEttOkG3Qi2SkeINxTbIv02/Ty00qYzv93ekC4mn7L9mx0PkErvSc6uFAubcvepfpxX5/ReLr2f8L2/jy0SV0l0JhyE+B7IW8576FAN8v5u1DAnfkKQiaA2alEh3u7+JAuF1z9u2uNgJO1WClNTILL8WjE/vBOayJb6DIHcILpSAlXMVZEaJYGdrZBTCuI9d34qUrGR59iBXXGnyXV7Hh9l+UmpUqFdwczckX2Ct6j8qXraIsYc1ykYrKC/2uq2LDYnMiCGk2IzcKhteI9iWjq+vm4IvfrmHZ/zgozM4UWiN6vCCw8vFJP2KRKjqlMdPxUy/7gmqHUOyU7Rts+PCQ9sZ61shVvpValGUCquKF5k7f8ESPBV8q4BUH1T7lv7iX80W5sfea1dGbYDG+8hgYQpWg8wRsJ9T22pIP91ioEvs3prg1ja00hu0uQp1kBjwSmX7idANw0DFTMba3bo28Zp3V6hOyUSJhNgwQDM0T7Uq1vmNLj2E008SG21dAehuM=
  file:
  - ${cnt}${slim}.tar.xz 
  - ${cnt}${slim}-latest.aci 
  skip_cleanup: true
  on:
    tags: true
