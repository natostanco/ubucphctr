install: true
services:
- docker
env:
  global:
    - secure: "tKdqnnYU05yQDcLW3CLzJgo/e/VSBSGb1ys/WRNFwk9P5kYG+mwzIb7nWLgr2p+k2UmFgD6PBuxLyP5eGIgx3oYyDWXEzVKIpIL+baxb+3YLp7AsPxOpt6CB7yYS6+JhjH3rP60jogAAw5hPC4HcJN9nX31vFQTYD8Ys+7L/AlnlVnemgv/9NiWZwfuUfAznnEFdYV0PuPnfYkd4qF6LgGOXGKWgi8LotS2nqp3fxQjajo03VN4HoRDS1kkmdht6pxVtYlWrErXrhVG0ClEbdp+ZCqCUXy7PUp/8Ner0yttvR7AfMY3imk9rl5j48TWPauyIM9W/9oBGdTzjKFVXQb7okZByeNC9EKwf7vdFhbyVUdjqV6XMvqYRF6J75JGKcy1hjXOhY9DJV2TfODxo5M9bfzZilrF1fkT+EdOQXDkaJpj35IS6Bs5YIis1LIyKYWCv6qsbilteFrnfcuN/JZ+VqMa9+jYcoFwp3g2pEJk7gl3sHwdwWpvaOClk8rldSDI6Bax56mvaKXNjsGlbrtXp8XDNsw9aSasF5zdsKbhZQ8POzquAa/DtiAGjwEx29Sak4i4drO81k/gH1MaOKRLUsKJzOyRin1LHBkZfHEGVvC8kyKeAplCa89MupIcav9US2tjPGh7Sn0PPWxKrX4CMqh4kiSBrv8XKWMoANVU="
    - secure: "XToLVQbY07O5VthtCOU6JlTPybKstgBvauwZdKXBzkkyzZBtbKGN76tZw6Reot3XNcJVc9CqLe0IyeMe6baEE9xf5y4lKKsjePt9yjKvBqrZwYaHygFdElmdKTZw9FP4ksyEiO0N1JBSfVSTy74XkEpB00blcOwzVVOZ8Gz11LPanajMcFadtPfH2cmRbaNoA7zxkM0XWi7+G/VcqIk+N8VluTskbCroIRyfrPJLIVXMocLYtODeNQDFoGTxgbaIBCGj2j2SBpPRngEvTMMG2cuIAvV8Sn2G3YaRW+ENu+lbcy4mBVBkW5OaYn/nb9Fe6J0BvsSNQlP+Vx32Hl2XQHTDv5fp005Q5IGV1rBZaRH9f69+nhLWu3DP3jZYd2DlgWKNzUPk9ctTxvbyRz6dImkyo5KCmUUcIbZPbOJKlKlwwxMGMNlB9dha5H3bUQVAyAhl7oXlLYQ1TUDxfFtbzm2cm1DZ1wPt7Qd7l+Vm1oJ89bLwkZ14z5oq8UsWf11mU+HTWiwhLHoxvFXne/I4sAvb7RqwpMc0zNVCBO1Pk6NyMlUWnUvd1+OzFkBHA8G3QhKjXWJKMXDQJpyExxKWAzE3IjcaTFqTw10hd+WZH4zzcT7phWsndd+uYNQA/tGey4WOCB5nIAP938qgWG/ZtTmIbpkrf+4cI8U5GsFECkQ="
    - secure: "Go2hrCioeYJaAGiLAFVrvEzXnllhYNlrH3UFcQX+DwueHXHIks4BJoMm15ZnFDvVxaUNqZA4zEAY29HBhLcqNkG9UFPiLsMOqFSYLANfJFU6fwL5poNPjg+n/mfPgvPo9s7clCglOq2d/rxFF5Nzq92UwQTh8e3AQtop2qTeKEjx1bGHPEILqjG17/OtcKYrVLV5/I+rSRywKlDhygwIRa8Wf/QzfLW1no/Uf6y8yLzHUFpNRvAu3MsoBDZvUBasTWU62ic29xZ7mdipadeMhNUAVrWvX4w3S74UezaD31BSWF+yjvYu9aUuRfXLhQFso5DBQDkA+2eGmeeWBzrET6uhGIpg7OI/aPl7e1B+GeEvk651683HVkcWNfa00rMV7EtzG8HhHMIeZ/v9iYsWkPKGz2k11BXLyhL4YLebeJhLIJjJXCgP0jvkejzEQfUiIYHeehx7cn/MUVhNvmSFL1p/Lm9hJKd+x8Bxz0pnatjZi84y2zfF3RDZ/SzgIaiR5KIOU50dnV8LPzAXYcU2Gol1965Jzk70OItTlOlqZJ+xTCx2zdS2Pl4PrcdY+vQaNzhvJ6Z5e1u+2qwOLQrShyCGW7vYujytbmM30OJ6nl2vfaSS3gMtsn+Mep1zLOHcwgWnl4DA7VuwsZekhFZhnJODTIOF2Jn6KOGJH8ikP2A="
before_script:
- export SAVE=$PWD cnt="ubucphctr" slim=".slim" HostIP="172.17.0.1" 
- >
  docker run -d -p 4001:4001 -p 2380:2380 -p 2379:2379 
  --name etcd quay.io/coreos/etcd:v2.3.7
  -name etcd0 
  -advertise-client-urls http://${HostIP}:4001 
  -listen-client-urls http://0.0.0.0:4001 
  -initial-advertise-peer-urls http://${HostIP}:2380 
  -listen-peer-urls http://0.0.0.0:2380 
  -initial-cluster-token etcd-cluster-1 
  -initial-cluster etcd0=http://${HostIP}:2380 
  -initial-cluster-state new
script:
- "./scripts/slimceph"
- docker tag ceph/daemonip.slim ${cnt}${slim}
before_deploy:
- cd
- wget `curl -s https://api.github.com/repos/appc/docker2aci/releases | grep browser_download_url
  | head -n 1 | cut -d '"' -f 4` -O d2a.tar.gz
- tar -zxf d2a.tar.gz && rm d2a.tar.gz && d2a=`ls | grep "docker2aci*"` && d2a=`basename  $d2a`
  && alias d2a='${PWD}/${d2a}/docker2aci'
- docker save -o ${cnt}${slim}.tar ${cnt}${slim}
- "${PWD}/${d2a}/docker2aci ${cnt}${slim}.tar"
- docker login -e $QUAYE -u $QUAYL -p $QUAYP quay.io
- docker tag ${cnt}${slim} quay.io/natostanco/$cnt:$TRAVIS_TAG
- docker push quay.io/natostanco/$cnt:$TRAVIS_TAG
- xz -9 -c ${cnt}${slim}.tar > ${cnt}${slim}.tar.xz
deploy:
  provider: releases
  api_key:
    secure: kQf2HeVQyCTgEwVv9pOV3RSTReoIlkf/1Xl2TRquXwC8ZQDNw+BKfsNM6y7e/ApkFoFVK7fjE/Ct8r7IJ9IEre+lg7n5NkW3aSwimzlgZLdk+ePihaKs2SIpDIf29LogcRznP96CDbhR7jR7P3A0KnUc2VDw6EhlDRcfzkksI/bEttOkG3Qi2SkeINxTbIv02/Ty00qYzv93ekC4mn7L9mx0PkErvSc6uFAubcvepfpxX5/ReLr2f8L2/jy0SV0l0JhyE+B7IW8576FAN8v5u1DAnfkKQiaA2alEh3u7+JAuF1z9u2uNgJO1WClNTILL8WjE/vBOayJb6DIHcILpSAlXMVZEaJYGdrZBTCuI9d34qUrGR59iBXXGnyXV7Hh9l+UmpUqFdwczckX2Ct6j8qXraIsYc1ykYrKC/2uq2LDYnMiCGk2IzcKhteI9iWjq+vm4IvfrmHZ/zgozM4UWiN6vCCw8vFJP2KRKjqlMdPxUy/7gmqHUOyU7Rts+PCQ9sZ61shVvpValGUCquKF5k7f8ESPBV8q4BUH1T7lv7iX80W5sfea1dGbYDG+8hgYQpWg8wRsJ9T22pIP91ioEvs3prg1ja00hu0uQp1kBjwSmX7idANw0DFTMba3bo28Zp3V6hOyUSJhNgwQDM0T7Uq1vmNLj2E008SG21dAehuM=
  file:
  - ${cnt}${slim}.tar.xz 
  - ${cnt}${slim}-latest.aci 
  skip_cleanup: true
  on:
    tags: true
